# API æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£åˆ—å‡ºäº† Yusic-UI åº”ç”¨ç¨‹åºä½¿ç”¨çš„ API æ¥å£ï¼ŒåŒ…æ‹¬ HTTP REST API å’Œ WebSocket å®æ—¶äº‹ä»¶ã€‚

## HTTP REST API

**åŸºç¡€ URL:**
- å¼€å‘ç¯å¢ƒ: `/api` (ä»£ç†)
- ç”Ÿäº§ç¯å¢ƒ: `http://159.75.236.77/api`

**å“åº”æ ¼å¼:**
é™¤ç‰¹æ®Šè¯´æ˜ï¼ˆå¦‚è·å–æ’­æ”¾é“¾æ¥ï¼‰å¤–ï¼ŒAPI é€šå¸¸è¿”å›å¦‚ä¸‹ JSON ç»“æ„:
```json
{
    "code": 200,
    "msg": "success",
    "data": { ... }
}
```

### 1. æœç´¢éŸ³ä¹
ä»ä¸åŒçš„éŸ³ä¹æºæœç´¢æ­Œæ›²ã€‚

**æ¥å£:** `GET /`
**å‚æ•°:**
- `type`: `search` (å›ºå®šå€¼)
- `keyword`: æœç´¢å…³é”®è¯
- `source`: éŸ³ä¹æº (`netease`, `kuwo`, `qq`)
- `limit`: è¿”å›ç»“æœæ•°é‡ (é»˜è®¤: 20)
- `page`: é¡µç  (é»˜è®¤: 1)

**ç¤ºä¾‹:**
```http
GET /?type=search&keyword=Adele&source=netease&limit=10&page=1
```

### 2. è·å–æ’­æ”¾é“¾æ¥
è·å–æŒ‡å®šæ­Œæ›²çš„éŸ³é¢‘æµ URLã€‚

**æ¥å£:** `GET /`
**å‚æ•°:**
- `type`: `url` (å›ºå®šå€¼)
- `id`: æ­Œæ›²å”¯ä¸€ ID
- `source`: éŸ³ä¹æº (`netease`, `kuwo`, `qq`)
- `br`: éŸ³è´¨/æ¯”ç‰¹ç‡ (å¯é€‰)

**éŸ³è´¨å‚æ•° (br) å¯¹ç…§è¡¨:**

| å€¼ | è¯´æ˜ | æ¯”ç‰¹ç‡ |
| :--- | :--- | :--- |
| `128k` | æ ‡å‡†éŸ³è´¨ | 128kbps |
| `320k` | é«˜å“è´¨ | 320kbps |
| `flac` | æ— æŸéŸ³è´¨ | ~1000kbps |
| `flac24bit` | Hi-Res éŸ³è´¨ | ~1400kbps |

**ğŸ’¡ å“åº”è¯´æ˜ (Response):**
- æˆåŠŸæ—¶è¿”å› **302 Redirect** åˆ°å®é™…çš„éŸ³ä¹æ–‡ä»¶ URLã€‚
- è¿”å›çš„é‡å®šå‘æ–‡ä»¶ URL æ˜¯ **HTTP** åè®®ã€‚

**ç¤ºä¾‹:**
```http
GET /?type=url&id=123456&source=netease&br=320k
```

### 3. è·å–æ­Œæ›²è¯¦æƒ…
è·å–æ­Œæ›²çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å°é¢å›¾ç‰‡ã€‚

**æ¥å£:** `GET /`
**å‚æ•°:**
- `type`: `info` (å›ºå®šå€¼)
- `id`: æ­Œæ›²å”¯ä¸€ ID
- `source`: éŸ³ä¹æº (`netease`, `kuwo`, `qq`)

**ç¤ºä¾‹:**
```http
GET /?type=info&id=123456&source=netease
```

### 4. è·å–æ­Œè¯
è·å–æ­Œæ›²çš„æ­Œè¯ã€‚

**æ¥å£:** `GET /`
**å‚æ•°:**
- `type`: `lrc` (å›ºå®šå€¼)
- `id`: æ­Œæ›²å”¯ä¸€ ID
- `source`: éŸ³ä¹æº (`netease`, `kuwo`, `qq`)

**ç¤ºä¾‹:**
```http
GET /?type=lrc&id=123456&source=netease
```

### 5. è·å–ä¸“è¾‘å°é¢
è·å–ä¸“è¾‘å°é¢å›¾ç‰‡ URLã€‚

**æ¥å£:** `GET /`
**å‚æ•°:**
- `type`: `pic` (å›ºå®šå€¼)
- `id`: æ­Œæ›²å”¯ä¸€ ID
- `source`: éŸ³ä¹æº (`netease`, `kuwo`, `qq`)

**ç¤ºä¾‹:**
```http
GET /?type=pic&id=123456&source=netease
```

---

## WebSocket API (å®æ—¶é€šä¿¡)

ç”¨äºå³æ—¶åŒæ­¥æ’­æ”¾ã€èŠå¤©å®¤å’Œæ’­æ”¾åˆ—è¡¨ç®¡ç†ã€‚

### æˆ¿é—´ç®¡ç† (Room)

#### å‘é€äº‹ä»¶ (Client -> Server)
| äº‹ä»¶å | å‚æ•° | æè¿° | å›è°ƒå“åº” |
| :--- | :--- | :--- | :--- |
| `create-room` | (None) | åˆ›å»ºä¸€ä¸ªæ–°æˆ¿é—´ | `{ success, roomId, error }` |
| `join-room` | `roomId` | åŠ å…¥æŒ‡å®šæˆ¿é—´ | `{ success, data... }` |
| `sync:play` | `roomId`, `song`, `time` | åŒæ­¥æ’­æ”¾çŠ¶æ€ | - |
| `sync:pause` | `roomId`, `time` | åŒæ­¥æš‚åœçŠ¶æ€ | - |
| `sync:seek` | `roomId`, `time` | åŒæ­¥è¿›åº¦è·³è½¬ | - |
| `sync:queue` | `roomId`, `queue` | åŒæ­¥æ’­æ”¾åˆ—è¡¨ | - |
| `emote` | `roomId`, `emoji` | å‘é€è¡¨æƒ… | - |
| `typing` | `roomId` | å‘é€æ­£åœ¨è¾“å…¥çŠ¶æ€ | - |

#### æ¥æ”¶äº‹ä»¶ (Server -> Client)
| äº‹ä»¶å | å‚æ•° | æè¿° |
| :--- | :--- | :--- |
| `notification` | `msg` | ç³»ç»Ÿé€šçŸ¥æ¶ˆæ¯ |
| `room-users` | `count` | å½“å‰æˆ¿é—´åœ¨çº¿äººæ•°æ›´æ–° |
| `emote` | `emoji` | æ¥æ”¶å…¶ä»–ç”¨æˆ·çš„è¡¨æƒ… |
| `room-typing` | (None) | æœ‰ç”¨æˆ·æ­£åœ¨è¾“å…¥ |
| `sync:play` | `song`, `time`, `senderId` | è¿œç¨‹è§¦å‘æ’­æ”¾ |
| `sync:pause` | (None) | è¿œç¨‹è§¦å‘æš‚åœ |
| `sync:seek` | `time` | è¿œç¨‹è§¦å‘è¿›åº¦è·³è½¬ |
| `sync:queue` | `queue` | è¿œç¨‹æ›´æ–°æ’­æ”¾åˆ—è¡¨ |

### æ’­æ”¾åˆ—è¡¨ç®¡ç† (Playlist)

#### å‘é€äº‹ä»¶ (Client -> Server)
| äº‹ä»¶å | å‚æ•° | æè¿° |
| :--- | :--- | :--- |
| `playlist:get-all` | (None) |ä»¥æ­¤è§¦å‘ `playlist:list` |
| `playlist:create` | `name` | åˆ›å»ºæ–°æ­Œå• |
| `playlist:delete` | `id` | åˆ é™¤æ­Œå• |
| `playlist:add` | `{ playlistId, song }` | æ·»åŠ æ­Œæ›²åˆ°æ­Œå• |
| `playlist:remove` | `{ playlistId, songId }` | ä»æ­Œå•ç§»é™¤æ­Œæ›² |

#### æ¥æ”¶äº‹ä»¶ (Server -> Client)
| äº‹ä»¶å | å‚æ•° | æè¿° |
| :--- | :--- | :--- |
| `playlist:list` | `Playlist[]` | æ¥æ”¶æ‰€æœ‰æ­Œå•åˆ—è¡¨ |
| `playlist:updated` | `Playlist` | æ¥æ”¶å•ä¸ªæ­Œå•çš„æ›´æ–° |

## éŸ³ä¹æºè¯´æ˜ (Music Sources)
`source` å‚æ•°æ”¯æŒä»¥ä¸‹å€¼:
- `netease`: ç½‘æ˜“äº‘éŸ³ä¹
- `kuwo`: é…·æˆ‘éŸ³ä¹
- `qq`: QQ éŸ³ä¹
